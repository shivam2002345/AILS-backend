"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
/*
 * Copyright (c) 2018 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var transform_1 = require("./transform");
var config_1 = require("./../../config");
var filelink_1 = require("./../filelink");
jest.mock('./../filelink');
var defaultApikey = 'EXAMPLE_API_KEY';
var defaultHandle = 'EXAMPLE_HANDLE';
var defaultSecurity = {
    policy: 'examplePolicy',
    signature: 'exampleSignature',
};
var sessionURls = config_1.config.urls;
var defaultSession = {
    apikey: defaultApikey,
    urls: sessionURls,
};
describe('OldTransforms', function () {
    it('should pass params to Filelink class', function () {
        (0, transform_1.transform)(defaultSession, defaultHandle, {
            partial_pixelate: {
                amount: 2,
            },
        });
        expect(filelink_1.Filelink.prototype.addTask).toHaveBeenCalledWith('partial_pixelate', {
            amount: 2,
        });
    });
    it('should respect security params', function () {
        (0, transform_1.transform)(tslib_1.__assign(tslib_1.__assign({}, defaultSession), defaultSecurity), defaultHandle, {
            partial_pixelate: {
                amount: 2,
            },
        });
        expect(filelink_1.Filelink.prototype.addTask).toHaveBeenCalledWith('security', defaultSecurity);
    });
    it('should respect cache=false transformation', function () {
        (0, transform_1.transform)(defaultSession, defaultHandle, {
            // @ts-ignore
            cache: false,
        });
        expect(filelink_1.Filelink.prototype.addTask).toHaveBeenCalledWith('cache', false);
    });
    it('should remove falsy parameters transformation', function () {
        (0, transform_1.transform)(defaultSession, defaultHandle, {
            flip: false,
        });
        expect(filelink_1.Filelink.prototype.addTask).not.toHaveBeenCalledWith('flip', false);
    });
    it('should change cammel case to snake case transformations', function () {
        (0, transform_1.transform)(defaultSession, defaultHandle, {
            // @ts-ignore
            partialPixelate: {
                amount: 2,
            },
        });
        expect(filelink_1.Filelink.prototype.addTask).toHaveBeenCalledWith('partial_pixelate', {
            amount: 2,
        });
    });
    it('return call toString on filelink when params are empty', function () {
        var testUrl = 'nanana';
        jest.spyOn(filelink_1.Filelink.prototype, 'toString').mockImplementation(function () { return testUrl; });
        expect((0, transform_1.transform)(defaultSession, defaultHandle)).toEqual(testUrl);
    });
    it('should enable base64 on filelink', function () {
        (0, transform_1.transform)(defaultSession, defaultHandle, {
            // @ts-ignore
            partialPixelate: {
                amount: 2,
            },
        }, true);
        expect(filelink_1.Filelink.prototype.setBase64).toHaveBeenCalledWith(true);
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL3RyYW5zZm9ybS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUNILHlDQUF3QztBQUN4Qyx5Q0FBd0M7QUFDeEMsMENBQXlDO0FBRXpDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFM0IsSUFBTSxhQUFhLEdBQUcsaUJBQWlCLENBQUM7QUFDeEMsSUFBTSxhQUFhLEdBQUcsZ0JBQWdCLENBQUM7QUFDdkMsSUFBTSxlQUFlLEdBQUc7SUFDdEIsTUFBTSxFQUFFLGVBQWU7SUFDdkIsU0FBUyxFQUFFLGtCQUFrQjtDQUM5QixDQUFDO0FBRUYsSUFBTSxXQUFXLEdBQUcsZUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQyxJQUFNLGNBQWMsR0FBRztJQUNyQixNQUFNLEVBQUUsYUFBYTtJQUNyQixJQUFJLEVBQUUsV0FBVztDQUNsQixDQUFDO0FBRUYsUUFBUSxDQUFDLGVBQWUsRUFBRTtJQUN4QixFQUFFLENBQUMsc0NBQXNDLEVBQUU7UUFDekMsSUFBQSxxQkFBUyxFQUNQLGNBQWMsRUFDZCxhQUFhLEVBQ2I7WUFDRSxnQkFBZ0IsRUFBRTtnQkFDaEIsTUFBTSxFQUFFLENBQUM7YUFDVjtTQUNGLENBQ0YsQ0FBQztRQUVGLE1BQU0sQ0FBQyxtQkFBUSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxrQkFBa0IsRUFBRTtZQUMxRSxNQUFNLEVBQUUsQ0FBQztTQUNWLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLGdDQUFnQyxFQUFFO1FBQ25DLElBQUEscUJBQVMsd0NBRUYsY0FBYyxHQUNkLGVBQWUsR0FFcEIsYUFBYSxFQUNiO1lBQ0UsZ0JBQWdCLEVBQUU7Z0JBQ2hCLE1BQU0sRUFBRSxDQUFDO2FBQ1Y7U0FDRixDQUNGLENBQUM7UUFFRixNQUFNLENBQUMsbUJBQVEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsb0JBQW9CLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQ3ZGLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDJDQUEyQyxFQUFFO1FBQzlDLElBQUEscUJBQVMsRUFDUCxjQUFjLEVBQ2QsYUFBYSxFQUNiO1lBQ0UsYUFBYTtZQUNiLEtBQUssRUFBRSxLQUFLO1NBQ2IsQ0FDRixDQUFDO1FBRUYsTUFBTSxDQUFDLG1CQUFRLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMxRSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywrQ0FBK0MsRUFBRTtRQUNsRCxJQUFBLHFCQUFTLEVBQ1AsY0FBYyxFQUNkLGFBQWEsRUFDYjtZQUNFLElBQUksRUFBRSxLQUFLO1NBQ1osQ0FDRixDQUFDO1FBRUYsTUFBTSxDQUFDLG1CQUFRLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDN0UsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMseURBQXlELEVBQUU7UUFDNUQsSUFBQSxxQkFBUyxFQUNQLGNBQWMsRUFDZCxhQUFhLEVBQ2I7WUFDRSxhQUFhO1lBQ2IsZUFBZSxFQUFFO2dCQUNmLE1BQU0sRUFBRSxDQUFDO2FBQ1Y7U0FDRixDQUNGLENBQUM7UUFFRixNQUFNLENBQUMsbUJBQVEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsb0JBQW9CLENBQUMsa0JBQWtCLEVBQUU7WUFDMUUsTUFBTSxFQUFFLENBQUM7U0FDVixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx3REFBd0QsRUFBRTtRQUMzRCxJQUFNLE9BQU8sR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLEtBQUssQ0FBQyxtQkFBUSxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxjQUFNLE9BQUEsT0FBTyxFQUFQLENBQU8sQ0FBQyxDQUFDO1FBRTdFLE1BQU0sQ0FBQyxJQUFBLHFCQUFTLEVBQ2QsY0FBYyxFQUNkLGFBQWEsQ0FDZCxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLGtDQUFrQyxFQUFFO1FBQ3JDLElBQUEscUJBQVMsRUFDUCxjQUFjLEVBQ2QsYUFBYSxFQUNiO1lBQ0UsYUFBYTtZQUNiLGVBQWUsRUFBRTtnQkFDZixNQUFNLEVBQUUsQ0FBQzthQUNWO1NBQ0YsRUFDRCxJQUFJLENBQ0wsQ0FBQztRQUVGLE1BQU0sQ0FBQyxtQkFBUSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsRSxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImxpYi9hcGkvdHJhbnNmb3JtLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IChjKSAyMDE4IGJ5IEZpbGVzdGFjay5cbiAqIFNvbWUgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgdHJhbnNmb3JtIH0gZnJvbSAnLi90cmFuc2Zvcm0nO1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnLi8uLi8uLi9jb25maWcnO1xuaW1wb3J0IHsgRmlsZWxpbmsgfSBmcm9tICcuLy4uL2ZpbGVsaW5rJztcblxuamVzdC5tb2NrKCcuLy4uL2ZpbGVsaW5rJyk7XG5cbmNvbnN0IGRlZmF1bHRBcGlrZXkgPSAnRVhBTVBMRV9BUElfS0VZJztcbmNvbnN0IGRlZmF1bHRIYW5kbGUgPSAnRVhBTVBMRV9IQU5ETEUnO1xuY29uc3QgZGVmYXVsdFNlY3VyaXR5ID0ge1xuICBwb2xpY3k6ICdleGFtcGxlUG9saWN5JyxcbiAgc2lnbmF0dXJlOiAnZXhhbXBsZVNpZ25hdHVyZScsXG59O1xuXG5jb25zdCBzZXNzaW9uVVJscyA9IGNvbmZpZy51cmxzO1xuY29uc3QgZGVmYXVsdFNlc3Npb24gPSB7XG4gIGFwaWtleTogZGVmYXVsdEFwaWtleSxcbiAgdXJsczogc2Vzc2lvblVSbHMsXG59O1xuXG5kZXNjcmliZSgnT2xkVHJhbnNmb3JtcycsICgpID0+IHtcbiAgaXQoJ3Nob3VsZCBwYXNzIHBhcmFtcyB0byBGaWxlbGluayBjbGFzcycsICgpID0+IHtcbiAgICB0cmFuc2Zvcm0oXG4gICAgICBkZWZhdWx0U2Vzc2lvbixcbiAgICAgIGRlZmF1bHRIYW5kbGUsXG4gICAgICB7XG4gICAgICAgIHBhcnRpYWxfcGl4ZWxhdGU6IHtcbiAgICAgICAgICBhbW91bnQ6IDIsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcblxuICAgIGV4cGVjdChGaWxlbGluay5wcm90b3R5cGUuYWRkVGFzaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3BhcnRpYWxfcGl4ZWxhdGUnLCB7XG4gICAgICBhbW91bnQ6IDIsXG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVzcGVjdCBzZWN1cml0eSBwYXJhbXMnLCAoKSA9PiB7XG4gICAgdHJhbnNmb3JtKFxuICAgICAge1xuICAgICAgICAuLi5kZWZhdWx0U2Vzc2lvbixcbiAgICAgICAgLi4uZGVmYXVsdFNlY3VyaXR5LFxuICAgICAgfSxcbiAgICAgIGRlZmF1bHRIYW5kbGUsXG4gICAgICB7XG4gICAgICAgIHBhcnRpYWxfcGl4ZWxhdGU6IHtcbiAgICAgICAgICBhbW91bnQ6IDIsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcblxuICAgIGV4cGVjdChGaWxlbGluay5wcm90b3R5cGUuYWRkVGFzaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NlY3VyaXR5JywgZGVmYXVsdFNlY3VyaXR5KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZXNwZWN0IGNhY2hlPWZhbHNlIHRyYW5zZm9ybWF0aW9uJywgKCkgPT4ge1xuICAgIHRyYW5zZm9ybShcbiAgICAgIGRlZmF1bHRTZXNzaW9uLFxuICAgICAgZGVmYXVsdEhhbmRsZSxcbiAgICAgIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICB9XG4gICAgKTtcblxuICAgIGV4cGVjdChGaWxlbGluay5wcm90b3R5cGUuYWRkVGFzaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NhY2hlJywgZmFsc2UpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlbW92ZSBmYWxzeSBwYXJhbWV0ZXJzIHRyYW5zZm9ybWF0aW9uJywgKCkgPT4ge1xuICAgIHRyYW5zZm9ybShcbiAgICAgIGRlZmF1bHRTZXNzaW9uLFxuICAgICAgZGVmYXVsdEhhbmRsZSxcbiAgICAgIHtcbiAgICAgICAgZmxpcDogZmFsc2UsXG4gICAgICB9XG4gICAgKTtcblxuICAgIGV4cGVjdChGaWxlbGluay5wcm90b3R5cGUuYWRkVGFzaykubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdmbGlwJywgZmFsc2UpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNoYW5nZSBjYW1tZWwgY2FzZSB0byBzbmFrZSBjYXNlIHRyYW5zZm9ybWF0aW9ucycsICgpID0+IHtcbiAgICB0cmFuc2Zvcm0oXG4gICAgICBkZWZhdWx0U2Vzc2lvbixcbiAgICAgIGRlZmF1bHRIYW5kbGUsXG4gICAgICB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcGFydGlhbFBpeGVsYXRlOiB7XG4gICAgICAgICAgYW1vdW50OiAyLFxuICAgICAgICB9LFxuICAgICAgfVxuICAgICk7XG5cbiAgICBleHBlY3QoRmlsZWxpbmsucHJvdG90eXBlLmFkZFRhc2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwYXJ0aWFsX3BpeGVsYXRlJywge1xuICAgICAgYW1vdW50OiAyLFxuICAgIH0pO1xuICB9KTtcblxuICBpdCgncmV0dXJuIGNhbGwgdG9TdHJpbmcgb24gZmlsZWxpbmsgd2hlbiBwYXJhbXMgYXJlIGVtcHR5JywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3RVcmwgPSAnbmFuYW5hJztcbiAgICBqZXN0LnNweU9uKEZpbGVsaW5rLnByb3RvdHlwZSwgJ3RvU3RyaW5nJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHRlc3RVcmwpO1xuXG4gICAgZXhwZWN0KHRyYW5zZm9ybShcbiAgICAgIGRlZmF1bHRTZXNzaW9uLFxuICAgICAgZGVmYXVsdEhhbmRsZVxuICAgICkpLnRvRXF1YWwodGVzdFVybCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZW5hYmxlIGJhc2U2NCBvbiBmaWxlbGluaycsICgpID0+IHtcbiAgICB0cmFuc2Zvcm0oXG4gICAgICBkZWZhdWx0U2Vzc2lvbixcbiAgICAgIGRlZmF1bHRIYW5kbGUsXG4gICAgICB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcGFydGlhbFBpeGVsYXRlOiB7XG4gICAgICAgICAgYW1vdW50OiAyLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHRydWVcbiAgICApO1xuXG4gICAgZXhwZWN0KEZpbGVsaW5rLnByb3RvdHlwZS5zZXRCYXNlNjQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHRydWUpO1xuICB9KTtcbn0pO1xuIl19
