"use strict";
/*
 * Copyright (c) 2019 by Filestack.
 * Some rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var config_1 = require("./../../config");
var cloud_1 = require("./cloud");
var utils = tslib_1.__importStar(require("./../utils/index.node"));
var nock_1 = tslib_1.__importDefault(require("nock"));
var store_1 = require("../utils/store");
var testApiKey = 'API_KEY';
var testTokSession = 'TOK_SESSION';
var testTokArchiveId = 'ARCHIVE_ID';
var testCloudToken = 'testCloudToken';
var testSecurity = {
    policy: 'examplePolicy',
    signature: 'exampleSignature',
};
var sessionURls = config_1.config.urls;
var testSession = {
    apikey: testApiKey,
    urls: sessionURls,
};
var scope = (0, nock_1.default)(sessionURls.cloudApiUrl);
scope.defaultReplyHeaders({
    'access-control-allow-origin': function (req) { var _a; return (_a = req.getHeader('origin')) === null || _a === void 0 ? void 0 : _a.toString(); },
    'access-control-allow-methods': function (req) { var _a; return (_a = req.getHeader('access-control-request-method')) === null || _a === void 0 ? void 0 : _a.toString(); },
    'access-control-allow-headers': function (req) { var _a; return (_a = req.getHeader('access-control-request-headers')) === null || _a === void 0 ? void 0 : _a.toString(); },
    'content-type': 'application/json',
});
var mockTokInit = jest
    .fn()
    .mockName('tokInit')
    .mockReturnValue('init');
var mockTokStart = jest
    .fn()
    .mockName('tokStart')
    .mockReturnValue('start');
var mockTokStop = jest
    .fn()
    .mockName('tokStop')
    .mockReturnValue('stop');
var mockMetadata = jest
    .fn()
    .mockName('metadata')
    .mockReturnValue('metadata');
var mockList = jest
    .fn()
    .mockName('list')
    .mockImplementation(function (data) {
    if (data && data.clouds.token) {
        return { token: testCloudToken };
    }
    return data;
});
var mockLogout = jest
    .fn()
    .mockName('logout')
    .mockImplementation(function (url, params) {
    if (params.clouds && params.clouds.token) {
        return { token: testCloudToken };
    }
    return params;
});
var mockStore = jest
    .fn()
    .mockName('store')
    .mockImplementation(function (params) {
    if (params && params.clouds && params.clouds.token) {
        return JSON.stringify({ token: testCloudToken });
    }
    return JSON.stringify(params);
});
describe('cloud', function () {
    beforeEach(function () {
        scope
            .persist()
            .options(/.*/)
            .reply(204, '', {
            'access-control-allow-headers': 'filestack-source,filestack-trace-id,filestack-trace-span',
            'access-control-allow-methods': '*',
            'access-control-allow-origin': '*',
        });
        scope.post('/auth/logout').reply(200, mockLogout);
        scope.post('/folder/list').reply(200, function (_, data) { return mockList(data); });
        scope.post('/store/').reply(200, function (_, data) { return mockStore(data); });
        scope.post('/metadata').reply(200, mockMetadata);
        scope.post(/\/recording\/(audio|video)\/init/).reply(200, mockTokInit);
        scope.post(/\/recording\/(audio|video)\/start/).reply(200, mockTokStart);
        scope.post(/\/recording\/(audio|video)\/stop/).reply(200, mockTokStop);
    });
    afterEach(function () {
        nock_1.default.cleanAll();
        jest.clearAllMocks();
        localStorage.clear();
    });
    describe('cancelToken', function () {
        var testDomain = 'http://delay.filestack.test';
        var scopeD;
        beforeEach(function () {
            scopeD = (0, nock_1.default)(testDomain);
            scopeD
                .post('/store/')
                .delay(4000)
                .reply(200);
            scopeD
                .post('/folder/list')
                .delay(4000)
                .reply(200);
            scopeD
                .persist()
                .options(/.*/)
                .reply(204, '', {
                'access-control-allow-headers': 'filestack-source,filestack-trace-id,filestack-trace-span',
                'access-control-allow-methods': '*',
                'access-control-allow-origin': '*',
            });
        });
        afterEach(function () {
            nock_1.default.cleanAll();
            jest.clearAllMocks();
            localStorage.clear();
        });
        it('Should cancel store request', function (done) {
            var sessionClone = JSON.parse(JSON.stringify(testSession));
            sessionClone.urls.cloudApiUrl = testDomain;
            var token = {};
            new cloud_1.CloudClient(sessionClone)
                .store('google', 'test', { filename: '1', location: 'gcs' }, {}, token)
                .then(function () {
                done('Request not canceled');
            })
                .catch(function (err) {
                expect(err).toEqual(expect.any(Error));
                done();
            });
            setTimeout(function () {
                // @ts-ignore
                token.cancel();
            }, 500);
        });
        it('Should cancel list request', function (done) {
            var sessionClone = JSON.parse(JSON.stringify(testSession));
            sessionClone.urls.cloudApiUrl = testDomain;
            var token = {};
            new cloud_1.CloudClient(sessionClone)
                .list('google', token)
                .then(function () {
                done('Request not canceled');
            })
                .catch(function (err) {
                expect(err).toEqual(expect.any(Error));
                done();
            });
            setTimeout(function () {
                // @ts-ignore
                token.cancel();
            }, 500);
        });
    });
    describe('facebook inapp browser', function () {
        it('should set token to sessionStore when inapp browser is detected', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var client, token, store;
            return tslib_1.__generator(this, function (_a) {
                jest.spyOn(utils, 'isFacebook').mockReturnValue(true);
                client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                    prefetch: {
                        settings: {
                            inapp_browser: true,
                        },
                        pickerOptions: {},
                    },
                }));
                token = 'test';
                client.token = token;
                store = new store_1.Store();
                expect(store.getItem(cloud_1.PICKER_KEY, store_1.STORE_TYPE.SESSION)).toEqual(token);
                store.setItem(cloud_1.PICKER_KEY, undefined, store_1.STORE_TYPE.SESSION);
                return [2 /*return*/];
            });
        }); });
        it('should get token from sessionStore when inapp browser is detected', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var client, store, token;
            return tslib_1.__generator(this, function (_a) {
                jest.spyOn(utils, 'isFacebook').mockReturnValue(true);
                client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                    prefetch: {
                        settings: {
                            inapp_browser: true,
                        },
                        pickerOptions: {},
                    },
                }));
                store = new store_1.Store();
                token = 'test';
                store.setItem(cloud_1.PICKER_KEY, token, store_1.STORE_TYPE.SESSION);
                expect(client.token).toEqual(token);
                store.setItem(cloud_1.PICKER_KEY, undefined, store_1.STORE_TYPE.SESSION);
                return [2 /*return*/];
            });
        }); });
        it('should send appurl in list action', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, client, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                            prefetch: {
                                settings: {
                                    inapp_browser: true,
                                },
                                pickerOptions: {},
                            },
                        }));
                        return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            appurl: 'http://localhost/?fs-tab=init',
                            clouds: clouds,
                            token: null,
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should send pass mimetypes to backend as string', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, client, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                            prefetch: {
                                settings: {
                                    inapp_browser: true,
                                },
                                pickerOptions: {},
                            },
                        }));
                        return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds), {}, 'image/*')];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            appurl: 'http://localhost/?fs-tab=init',
                            clouds: clouds,
                            token: null,
                            accept: ['image/*'],
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should send pass mimetypes to backend as array', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, client, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                            prefetch: {
                                settings: {
                                    inapp_browser: true,
                                },
                                pickerOptions: {},
                            },
                        }));
                        return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds), {}, ['image/*'])];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            appurl: 'http://localhost/?fs-tab=init',
                            clouds: clouds,
                            token: null,
                            accept: ['image/*'],
                        });
                        return [2 /*return*/];
                }
            });
        }); });
    });
    it('should not send app url if urlsearch params is undefined', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
        var clouds, before, client, res;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    clouds = { test: true };
                    before = window.URLSearchParams;
                    window.URLSearchParams = undefined;
                    client = new cloud_1.CloudClient(Object.assign({}, testSession, {
                        prefetch: {
                            settings: {
                                inapp_browser: true,
                            },
                            pickerOptions: {},
                        },
                    }));
                    return [4 /*yield*/, client.list(tslib_1.__assign({}, clouds))];
                case 1:
                    res = _a.sent();
                    expect(res).toEqual({
                        apikey: testApiKey,
                        flow: 'web',
                        clouds: clouds,
                        token: null,
                    });
                    window.URLSearchParams = before;
                    return [2 /*return*/];
            }
        });
    }); });
    describe('list', function () {
        it('should make correct list request', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: clouds,
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct list request with session cache', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        localStorage.setItem(cloud_1.PICKER_KEY, testCloudToken);
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession, {
                                sessionCache: true,
                            }).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            token: testCloudToken,
                            clouds: clouds,
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should set token on api token response', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { token: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({ token: testCloudToken });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should cache session token to local storage', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { token: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession, { sessionCache: true }).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(localStorage.setItem).toHaveBeenCalledWith(cloud_1.PICKER_KEY, testCloudToken);
                        expect(res).toEqual({ token: testCloudToken });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct list request with security', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var clouds, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        clouds = { test: true };
                        return [4 /*yield*/, new cloud_1.CloudClient(tslib_1.__assign(tslib_1.__assign({}, testSession), testSecurity)).list(tslib_1.__assign({}, clouds))];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual(tslib_1.__assign({ apikey: testApiKey, flow: 'web', clouds: clouds }, testSecurity));
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('store', function () {
        it('should make correct basic request', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('google', 'test', { filename: '1' })];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: {
                                google: {
                                    path: 'test',
                                    store: {
                                        filename: '1',
                                        location: 's3',
                                    },
                                },
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect store location param', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('google', 'test', { filename: '1', location: 'gcs' })];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: {
                                google: {
                                    path: 'test',
                                    store: {
                                        filename: '1',
                                        location: 'gcs',
                                    },
                                },
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should respect store upload tags', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var uploadTags, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        uploadTags = { testTag: 'testTag' };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('google', 'test', {}, null, null, uploadTags)];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            upload_tags: uploadTags,
                            clouds: {
                                google: {
                                    path: 'test',
                                    store: {
                                        location: 's3',
                                    },
                                },
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct basic with security', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res, excepted;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, new cloud_1.CloudClient(tslib_1.__assign(tslib_1.__assign({}, testSession), testSecurity)).store('token', 'test', { filename: '1' })];
                    case 1:
                        res = _a.sent();
                        excepted = tslib_1.__assign(tslib_1.__assign({}, testSecurity), { apikey: testApiKey, flow: 'web', clouds: {
                                token: {
                                    path: 'test',
                                    store: {
                                        filename: '1',
                                        location: 's3',
                                    },
                                },
                            } });
                        expect(mockStore).toHaveBeenCalledWith(excepted);
                        expect(res).toEqual(testCloudToken);
                        return [2 /*return*/];
                }
            });
        }); });
        it('should handle custom source', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var customSource, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        customSource = {
                            customSourcePath: 'cs_path',
                            customSourceContainer: 'cs_container',
                        };
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).store('customsource', 'test', { filename: '1' }, customSource)];
                    case 1:
                        res = _a.sent();
                        expect(res).toEqual({
                            apikey: testApiKey,
                            flow: 'web',
                            clouds: {
                                customsource: tslib_1.__assign(tslib_1.__assign({}, customSource), { path: 'test', store: {
                                        filename: '1',
                                        location: 's3',
                                    } }),
                            },
                        });
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('logout', function () {
        it('should make correct request to logout', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).logout()];
                    case 1:
                        _a.apply(void 0, [_b.sent()]).toEqual({ apikey: 'API_KEY', flow: 'web' });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request to logout with provided cloud', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).logout('google')];
                    case 1:
                        _a.apply(void 0, [_b.sent()]).toEqual({ apikey: 'API_KEY', flow: 'web', clouds: { google: {} } });
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request to logout and return correct response when cloud name is returned', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = expect;
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).logout('token')];
                    case 1:
                        _a.apply(void 0, [_b.sent()]).toEqual('testCloudToken');
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request to logout and clean session cache ', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        localStorage.setItem(cloud_1.PICKER_KEY, testCloudToken);
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession, { sessionCache: true }).logout()];
                    case 1:
                        res = _a.sent();
                        expect(localStorage.removeItem).toHaveBeenCalledWith(cloud_1.PICKER_KEY);
                        expect(res).toEqual({ apikey: 'API_KEY', flow: 'web', token: testCloudToken });
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('metadata', function () {
        it('should make correct request', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var testUrl, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        testUrl = 'http://test.com';
                        return [4 /*yield*/, new cloud_1.CloudClient(testSession).metadata(testUrl)];
                    case 1:
                        res = _a.sent();
                        expect(mockMetadata).toHaveBeenCalledWith(expect.any(String), {
                            apikey: testApiKey,
                            url: testUrl,
                        });
                        expect(res).toEqual('metadata');
                        return [2 /*return*/];
                }
            });
        }); });
        it('should make correct request with security', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
            var testUrl, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        testUrl = 'http://test.com';
                        return [4 /*yield*/, new cloud_1.CloudClient(tslib_1.__assign(tslib_1.__assign({}, testSession), testSecurity)).metadata(testUrl)];
                    case 1:
                        res = _a.sent();
                        expect(mockMetadata).toHaveBeenCalledWith(expect.any(String), tslib_1.__assign({ apikey: testApiKey, url: testUrl }, testSecurity));
                        expect(res).toEqual('metadata');
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('OpenTok', function () {
        describe('tokInit', function () {
            it('should make correct request to api (audio)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokInit('audio')];
                        case 1:
                            res = _a.sent();
                            expect(mockTokInit).toHaveBeenCalledWith(expect.any(String), '');
                            expect(res).toEqual('init');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should make correct request to api (video)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokInit('audio')];
                        case 1:
                            res = _a.sent();
                            expect(mockTokInit).toHaveBeenCalledWith(expect.any(String), '');
                            expect(res).toEqual('init');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should throw on wrong type', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                return tslib_1.__generator(this, function (_a) {
                    expect(function () {
                        new cloud_1.CloudClient(testSession)
                            .tokInit('videoa')
                            .then(function () {
                            console.log('init');
                        })
                            .catch(function () {
                            console.log('err');
                        });
                    }).toThrowError();
                    return [2 /*return*/];
                });
            }); });
        });
        describe('tokStart', function () {
            it('should make correct request to api (audio)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStart('audio', 'key', testTokSession)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStart).toHaveBeenCalledWith(expect.any(String), { apikey: 'key', session_id: testTokSession });
                            expect(res).toEqual('start');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should make correct request to api (video)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStart('video', 'key', testTokSession)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStart).toHaveBeenCalledWith(expect.any(String), { apikey: 'key', session_id: testTokSession });
                            expect(res).toEqual('start');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should throw on wrong type', function () {
                expect(function () { return new cloud_1.CloudClient(testSession).tokStart('videoa', 'key', testTokSession); }).toThrowError();
            });
        });
        describe('tokStop', function () {
            it('should make correct request to api (audio)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStop('audio', 'key', testTokSession, testTokArchiveId)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStop).toHaveBeenCalledWith(expect.any(String), {
                                apikey: 'key',
                                session_id: testTokSession,
                                archive_id: testTokArchiveId,
                            });
                            expect(res).toEqual('stop');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should make correct request to api (video)', function () { return tslib_1.__awaiter(void 0, void 0, void 0, function () {
                var res;
                return tslib_1.__generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, new cloud_1.CloudClient(testSession).tokStop('video', 'key', testTokSession, testTokArchiveId)];
                        case 1:
                            res = _a.sent();
                            expect(mockTokStop).toHaveBeenCalledWith(expect.any(String), {
                                apikey: 'key',
                                session_id: testTokSession,
                                archive_id: testTokArchiveId,
                            });
                            expect(res).toEqual('stop');
                            return [2 /*return*/];
                    }
                });
            }); });
            it('should throw on wrong type', function () {
                expect(function () { return new cloud_1.CloudClient(testSession).tokStop('videoa', 'key', testTokSession, testTokArchiveId); }).toThrowError();
            });
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYXBpL2Nsb3VkLnNwZWMuYnJvd3Nlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHOzs7QUFFSCx5Q0FBd0M7QUFDeEMsaUNBQWtEO0FBQ2xELG1FQUErQztBQUMvQyxzREFBd0I7QUFDeEIsd0NBQW1EO0FBRW5ELElBQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQztBQUM3QixJQUFNLGNBQWMsR0FBRyxhQUFhLENBQUM7QUFDckMsSUFBTSxnQkFBZ0IsR0FBRyxZQUFZLENBQUM7QUFFdEMsSUFBTSxjQUFjLEdBQUcsZ0JBQWdCLENBQUM7QUFFeEMsSUFBTSxZQUFZLEdBQUc7SUFDbkIsTUFBTSxFQUFFLGVBQWU7SUFDdkIsU0FBUyxFQUFFLGtCQUFrQjtDQUM5QixDQUFDO0FBRUYsSUFBTSxXQUFXLEdBQUcsZUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQyxJQUFNLFdBQVcsR0FBRztJQUNsQixNQUFNLEVBQUUsVUFBVTtJQUNsQixJQUFJLEVBQUUsV0FBVztDQUNsQixDQUFDO0FBRUYsSUFBSSxLQUFLLEdBQUcsSUFBQSxjQUFJLEVBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBRTFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQztJQUN4Qiw2QkFBNkIsRUFBRSxVQUFVLEdBQUcsWUFBSSxPQUFPLE1BQUEsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsMENBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzdGLDhCQUE4QixFQUFFLFVBQVUsR0FBRyxZQUFJLE9BQU8sTUFBQSxHQUFHLENBQUMsU0FBUyxDQUFDLCtCQUErQixDQUFDLDBDQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNySCw4QkFBOEIsRUFBRSxVQUFVLEdBQUcsWUFBSSxPQUFPLE1BQUEsR0FBRyxDQUFDLFNBQVMsQ0FBQyxnQ0FBZ0MsQ0FBQywwQ0FBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENB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RyxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dDQUMzRCxNQUFNLEVBQUUsS0FBSztnQ0FDYixVQUFVLEVBQUUsY0FBYztnQ0FDMUIsVUFBVSxFQUFFLGdCQUFnQjs2QkFDN0IsQ0FBQyxDQUFDOzRCQUNILE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Ozs7aUJBQzdCLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyw0QkFBNEIsRUFBRTtnQkFDL0IsTUFBTSxDQUFDLGNBQU0sT0FBQSxJQUFJLG1CQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixDQUFDLEVBQXZGLENBQXVGLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN2SCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJsaWIvYXBpL2Nsb3VkLnNwZWMuYnJvd3Nlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgYnkgRmlsZXN0YWNrLlxuICogU29tZSByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICdMaWNlbnNlJyk7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnLi8uLi8uLi9jb25maWcnO1xuaW1wb3J0IHsgQ2xvdWRDbGllbnQsIFBJQ0tFUl9LRVkgfSBmcm9tICcuL2Nsb3VkJztcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4vLi4vdXRpbHMvaW5kZXgubm9kZSc7XG5pbXBvcnQgbm9jayBmcm9tICdub2NrJztcbmltcG9ydCB7IFN0b3JlLCBTVE9SRV9UWVBFIH0gZnJvbSAnLi4vdXRpbHMvc3RvcmUnO1xuXG5jb25zdCB0ZXN0QXBpS2V5ID0gJ0FQSV9LRVknO1xuY29uc3QgdGVzdFRva1Nlc3Npb24gPSAnVE9LX1NFU1NJT04nO1xuY29uc3QgdGVzdFRva0FyY2hpdmVJZCA9ICdBUkNISVZFX0lEJztcblxuY29uc3QgdGVzdENsb3VkVG9rZW4gPSAndGVzdENsb3VkVG9rZW4nO1xuXG5jb25zdCB0ZXN0U2VjdXJpdHkgPSB7XG4gIHBvbGljeTogJ2V4YW1wbGVQb2xpY3knLFxuICBzaWduYXR1cmU6ICdleGFtcGxlU2lnbmF0dXJlJyxcbn07XG5cbmNvbnN0IHNlc3Npb25VUmxzID0gY29uZmlnLnVybHM7XG5jb25zdCB0ZXN0U2Vzc2lvbiA9IHtcbiAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICB1cmxzOiBzZXNzaW9uVVJscyxcbn07XG5cbmxldCBzY29wZSA9IG5vY2soc2Vzc2lvblVSbHMuY2xvdWRBcGlVcmwpO1xuXG5zY29wZS5kZWZhdWx0UmVwbHlIZWFkZXJzKHtcbiAgJ2FjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpbic6IGZ1bmN0aW9uIChyZXEpIHsgcmV0dXJuIHJlcS5nZXRIZWFkZXIoJ29yaWdpbicpPy50b1N0cmluZygpOyB9LFxuICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctbWV0aG9kcyc6IGZ1bmN0aW9uIChyZXEpIHsgcmV0dXJuIHJlcS5nZXRIZWFkZXIoJ2FjY2Vzcy1jb250cm9sLXJlcXVlc3QtbWV0aG9kJyk/LnRvU3RyaW5nKCk7IH0sXG4gICdhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzJzogZnVuY3Rpb24gKHJlcSkgeyByZXR1cm4gcmVxLmdldEhlYWRlcignYWNjZXNzLWNvbnRyb2wtcmVxdWVzdC1oZWFkZXJzJyk/LnRvU3RyaW5nKCk7IH0sXG4gICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG59KTtcblxuY29uc3QgbW9ja1Rva0luaXQgPSBqZXN0XG4gIC5mbigpXG4gIC5tb2NrTmFtZSgndG9rSW5pdCcpXG4gIC5tb2NrUmV0dXJuVmFsdWUoJ2luaXQnKTtcblxuY29uc3QgbW9ja1Rva1N0YXJ0ID0gamVzdFxuICAuZm4oKVxuICAubW9ja05hbWUoJ3Rva1N0YXJ0JylcbiAgLm1vY2tSZXR1cm5WYWx1ZSgnc3RhcnQnKTtcblxuY29uc3QgbW9ja1Rva1N0b3AgPSBqZXN0XG4gIC5mbigpXG4gIC5tb2NrTmFtZSgndG9rU3RvcCcpXG4gIC5tb2NrUmV0dXJuVmFsdWUoJ3N0b3AnKTtcblxuY29uc3QgbW9ja01ldGFkYXRhID0gamVzdFxuICAuZm4oKVxuICAubW9ja05hbWUoJ21ldGFkYXRhJylcbiAgLm1vY2tSZXR1cm5WYWx1ZSgnbWV0YWRhdGEnKTtcblxuY29uc3QgbW9ja0xpc3QgPSBqZXN0XG4gIC5mbigpXG4gIC5tb2NrTmFtZSgnbGlzdCcpXG4gIC5tb2NrSW1wbGVtZW50YXRpb24oZGF0YSA9PiB7XG4gICAgaWYgKGRhdGEgJiYgZGF0YS5jbG91ZHMudG9rZW4pIHtcbiAgICAgIHJldHVybiB7IHRva2VuOiB0ZXN0Q2xvdWRUb2tlbiB9O1xuICAgIH1cblxuICAgIHJldHVybiBkYXRhO1xuICB9KTtcblxuY29uc3QgbW9ja0xvZ291dCA9IGplc3RcbiAgLmZuKClcbiAgLm1vY2tOYW1lKCdsb2dvdXQnKVxuICAubW9ja0ltcGxlbWVudGF0aW9uKCh1cmwsIHBhcmFtcykgPT4ge1xuICAgIGlmIChwYXJhbXMuY2xvdWRzICYmIHBhcmFtcy5jbG91ZHMudG9rZW4pIHtcbiAgICAgIHJldHVybiB7IHRva2VuOiB0ZXN0Q2xvdWRUb2tlbiB9O1xuICAgIH1cblxuICAgIHJldHVybiBwYXJhbXM7XG4gIH0pO1xuXG5jb25zdCBtb2NrU3RvcmUgPSBqZXN0XG4gIC5mbigpXG4gIC5tb2NrTmFtZSgnc3RvcmUnKVxuICAubW9ja0ltcGxlbWVudGF0aW9uKHBhcmFtcyA9PiB7XG4gICAgaWYgKHBhcmFtcyAmJiBwYXJhbXMuY2xvdWRzICYmIHBhcmFtcy5jbG91ZHMudG9rZW4pIHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh7IHRva2VuOiB0ZXN0Q2xvdWRUb2tlbiB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkocGFyYW1zKTtcbiAgfSk7XG5cbmRlc2NyaWJlKCdjbG91ZCcsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgc2NvcGVcbiAgICAgIC5wZXJzaXN0KClcbiAgICAgIC5vcHRpb25zKC8uKi8pXG4gICAgICAucmVwbHkoMjA0LCAnJywge1xuICAgICAgICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctaGVhZGVycyc6ICdmaWxlc3RhY2stc291cmNlLGZpbGVzdGFjay10cmFjZS1pZCxmaWxlc3RhY2stdHJhY2Utc3BhbicsXG4gICAgICAgICdhY2Nlc3MtY29udHJvbC1hbGxvdy1tZXRob2RzJzogJyonLFxuICAgICAgICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luJzogJyonLFxuICAgICAgfSk7XG5cbiAgICBzY29wZS5wb3N0KCcvYXV0aC9sb2dvdXQnKS5yZXBseSgyMDAsIG1vY2tMb2dvdXQpO1xuICAgIHNjb3BlLnBvc3QoJy9mb2xkZXIvbGlzdCcpLnJlcGx5KDIwMCwgKF8sIGRhdGEpID0+IG1vY2tMaXN0KGRhdGEpKTtcbiAgICBzY29wZS5wb3N0KCcvc3RvcmUvJykucmVwbHkoMjAwLCAoXywgZGF0YSkgPT4gbW9ja1N0b3JlKGRhdGEpKTtcbiAgICBzY29wZS5wb3N0KCcvbWV0YWRhdGEnKS5yZXBseSgyMDAsIG1vY2tNZXRhZGF0YSk7XG5cbiAgICBzY29wZS5wb3N0KC9cXC9yZWNvcmRpbmdcXC8oYXVkaW98dmlkZW8pXFwvaW5pdC8pLnJlcGx5KDIwMCwgbW9ja1Rva0luaXQpO1xuICAgIHNjb3BlLnBvc3QoL1xcL3JlY29yZGluZ1xcLyhhdWRpb3x2aWRlbylcXC9zdGFydC8pLnJlcGx5KDIwMCwgbW9ja1Rva1N0YXJ0KTtcbiAgICBzY29wZS5wb3N0KC9cXC9yZWNvcmRpbmdcXC8oYXVkaW98dmlkZW8pXFwvc3RvcC8pLnJlcGx5KDIwMCwgbW9ja1Rva1N0b3ApO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIG5vY2suY2xlYW5BbGwoKTtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbmNlbFRva2VuJywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3REb21haW4gPSAnaHR0cDovL2RlbGF5LmZpbGVzdGFjay50ZXN0JztcbiAgICBsZXQgc2NvcGVEO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzY29wZUQgPSBub2NrKHRlc3REb21haW4pO1xuXG4gICAgICBzY29wZURcbiAgICAgICAgLnBvc3QoJy9zdG9yZS8nKVxuICAgICAgICAuZGVsYXkoNDAwMClcbiAgICAgICAgLnJlcGx5KDIwMCk7XG4gICAgICBzY29wZURcbiAgICAgICAgLnBvc3QoJy9mb2xkZXIvbGlzdCcpXG4gICAgICAgIC5kZWxheSg0MDAwKVxuICAgICAgICAucmVwbHkoMjAwKTtcblxuICAgICAgc2NvcGVEXG4gICAgICAgIC5wZXJzaXN0KClcbiAgICAgICAgLm9wdGlvbnMoLy4qLylcbiAgICAgICAgLnJlcGx5KDIwNCwgJycsIHtcbiAgICAgICAgICAnYWNjZXNzLWNvbnRyb2wtYWxsb3ctaGVhZGVycyc6ICdmaWxlc3RhY2stc291cmNlLGZpbGVzdGFjay10cmFjZS1pZCxmaWxlc3RhY2stdHJhY2Utc3BhbicsXG4gICAgICAgICAgJ2FjY2Vzcy1jb250cm9sLWFsbG93LW1ldGhvZHMnOiAnKicsXG4gICAgICAgICAgJ2FjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpbic6ICcqJyxcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgbm9jay5jbGVhbkFsbCgpO1xuICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgY2FuY2VsIHN0b3JlIHJlcXVlc3QnLCBkb25lID0+IHtcbiAgICAgIGNvbnN0IHNlc3Npb25DbG9uZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGVzdFNlc3Npb24pKTtcbiAgICAgIHNlc3Npb25DbG9uZS51cmxzLmNsb3VkQXBpVXJsID0gdGVzdERvbWFpbjtcblxuICAgICAgbGV0IHRva2VuID0ge307XG5cbiAgICAgIG5ldyBDbG91ZENsaWVudChzZXNzaW9uQ2xvbmUpXG4gICAgICAgIC5zdG9yZSgnZ29vZ2xlJywgJ3Rlc3QnLCB7IGZpbGVuYW1lOiAnMScsIGxvY2F0aW9uOiAnZ2NzJyB9LCB7fSwgdG9rZW4pXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBkb25lKCdSZXF1ZXN0IG5vdCBjYW5jZWxlZCcpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICBleHBlY3QoZXJyKS50b0VxdWFsKGV4cGVjdC5hbnkoRXJyb3IpKTtcbiAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0b2tlbi5jYW5jZWwoKTtcbiAgICAgIH0sIDUwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIGNhbmNlbCBsaXN0IHJlcXVlc3QnLCBkb25lID0+IHtcbiAgICAgIGNvbnN0IHNlc3Npb25DbG9uZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGVzdFNlc3Npb24pKTtcbiAgICAgIHNlc3Npb25DbG9uZS51cmxzLmNsb3VkQXBpVXJsID0gdGVzdERvbWFpbjtcblxuICAgICAgbGV0IHRva2VuID0ge307XG5cbiAgICAgIG5ldyBDbG91ZENsaWVudChzZXNzaW9uQ2xvbmUpXG4gICAgICAgIC5saXN0KCdnb29nbGUnLCB0b2tlbilcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGRvbmUoJ1JlcXVlc3Qgbm90IGNhbmNlbGVkJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgIGV4cGVjdChlcnIpLnRvRXF1YWwoZXhwZWN0LmFueShFcnJvcikpO1xuICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHRva2VuLmNhbmNlbCgpO1xuICAgICAgfSwgNTAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZhY2Vib29rIGluYXBwIGJyb3dzZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgdG9rZW4gdG8gc2Vzc2lvblN0b3JlIHdoZW4gaW5hcHAgYnJvd3NlciBpcyBkZXRlY3RlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24odXRpbHMsICdpc0ZhY2Vib29rJykubW9ja1JldHVyblZhbHVlKHRydWUpO1xuXG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgQ2xvdWRDbGllbnQoT2JqZWN0LmFzc2lnbih7fSwgdGVzdFNlc3Npb24sIHtcbiAgICAgICAgcHJlZmV0Y2g6IHtcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgaW5hcHBfYnJvd3NlcjogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBpY2tlck9wdGlvbnM6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCB0b2tlbiA9ICd0ZXN0JztcbiAgICAgIGNsaWVudC50b2tlbiA9IHRva2VuO1xuXG4gICAgICBjb25zdCBzdG9yZSA9IG5ldyBTdG9yZSgpO1xuXG4gICAgICBleHBlY3Qoc3RvcmUuZ2V0SXRlbShQSUNLRVJfS0VZLCBTVE9SRV9UWVBFLlNFU1NJT04pKS50b0VxdWFsKHRva2VuKTtcbiAgICAgIHN0b3JlLnNldEl0ZW0oUElDS0VSX0tFWSwgdW5kZWZpbmVkLCBTVE9SRV9UWVBFLlNFU1NJT04pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdG9rZW4gZnJvbSBzZXNzaW9uU3RvcmUgd2hlbiBpbmFwcCBicm93c2VyIGlzIGRldGVjdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbih1dGlscywgJ2lzRmFjZWJvb2snKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBDbG91ZENsaWVudChPYmplY3QuYXNzaWduKHt9LCB0ZXN0U2Vzc2lvbiwge1xuICAgICAgICBwcmVmZXRjaDoge1xuICAgICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICBpbmFwcF9icm93c2VyOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGlja2VyT3B0aW9uczoge30sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIGNvbnN0IHN0b3JlID0gbmV3IFN0b3JlKCk7XG5cbiAgICAgIGNvbnN0IHRva2VuID0gJ3Rlc3QnO1xuICAgICAgc3RvcmUuc2V0SXRlbShQSUNLRVJfS0VZLCB0b2tlbiwgU1RPUkVfVFlQRS5TRVNTSU9OKTtcblxuICAgICAgZXhwZWN0KGNsaWVudC50b2tlbikudG9FcXVhbCh0b2tlbik7XG4gICAgICBzdG9yZS5zZXRJdGVtKFBJQ0tFUl9LRVksIHVuZGVmaW5lZCwgU1RPUkVfVFlQRS5TRVNTSU9OKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VuZCBhcHB1cmwgaW4gbGlzdCBhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbG91ZHMgPSB7IHRlc3Q6IHRydWUgfTtcblxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IENsb3VkQ2xpZW50KE9iamVjdC5hc3NpZ24oe30sIHRlc3RTZXNzaW9uLCB7XG4gICAgICAgIHByZWZldGNoOiB7XG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIGluYXBwX2Jyb3dzZXI6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwaWNrZXJPcHRpb25zOiB7fSxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2xpZW50Lmxpc3QoeyAuLi5jbG91ZHMgfSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBhcHB1cmw6ICdodHRwOi8vbG9jYWxob3N0Lz9mcy10YWI9aW5pdCcsXG4gICAgICAgIGNsb3VkcyxcbiAgICAgICAgdG9rZW46IG51bGwsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VuZCBwYXNzIG1pbWV0eXBlcyB0byBiYWNrZW5kIGFzIHN0cmluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsb3VkcyA9IHsgdGVzdDogdHJ1ZSB9O1xuXG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgQ2xvdWRDbGllbnQoT2JqZWN0LmFzc2lnbih7fSwgdGVzdFNlc3Npb24sIHtcbiAgICAgICAgcHJlZmV0Y2g6IHtcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgaW5hcHBfYnJvd3NlcjogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBpY2tlck9wdGlvbnM6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBjbGllbnQubGlzdCh7IC4uLmNsb3VkcyB9LCB7fSwgJ2ltYWdlLyonKTtcblxuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgZmxvdzogJ3dlYicsXG4gICAgICAgIGFwcHVybDogJ2h0dHA6Ly9sb2NhbGhvc3QvP2ZzLXRhYj1pbml0JyxcbiAgICAgICAgY2xvdWRzLFxuICAgICAgICB0b2tlbjogbnVsbCxcbiAgICAgICAgYWNjZXB0OiBbJ2ltYWdlLyonXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZW5kIHBhc3MgbWltZXR5cGVzIHRvIGJhY2tlbmQgYXMgYXJyYXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbG91ZHMgPSB7IHRlc3Q6IHRydWUgfTtcblxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IENsb3VkQ2xpZW50KE9iamVjdC5hc3NpZ24oe30sIHRlc3RTZXNzaW9uLCB7XG4gICAgICAgIHByZWZldGNoOiB7XG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIGluYXBwX2Jyb3dzZXI6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwaWNrZXJPcHRpb25zOiB7fSxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2xpZW50Lmxpc3QoeyAuLi5jbG91ZHMgfSwge30sIFsnaW1hZ2UvKiddKTtcblxuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgZmxvdzogJ3dlYicsXG4gICAgICAgIGFwcHVybDogJ2h0dHA6Ly9sb2NhbGhvc3QvP2ZzLXRhYj1pbml0JyxcbiAgICAgICAgY2xvdWRzLFxuICAgICAgICB0b2tlbjogbnVsbCxcbiAgICAgICAgYWNjZXB0OiBbJ2ltYWdlLyonXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCBzZW5kIGFwcCB1cmwgaWYgdXJsc2VhcmNoIHBhcmFtcyBpcyB1bmRlZmluZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgY2xvdWRzID0geyB0ZXN0OiB0cnVlIH07XG5cbiAgICBjb25zdCBiZWZvcmUgPSB3aW5kb3cuVVJMU2VhcmNoUGFyYW1zO1xuICAgIHdpbmRvdy5VUkxTZWFyY2hQYXJhbXMgPSB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCBjbGllbnQgPSBuZXcgQ2xvdWRDbGllbnQoT2JqZWN0LmFzc2lnbih7fSwgdGVzdFNlc3Npb24sIHtcbiAgICAgIHByZWZldGNoOiB7XG4gICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgaW5hcHBfYnJvd3NlcjogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgcGlja2VyT3B0aW9uczoge30sXG4gICAgICB9LFxuICAgIH0pKTtcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNsaWVudC5saXN0KHsgLi4uY2xvdWRzIH0pO1xuXG4gICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICBmbG93OiAnd2ViJyxcbiAgICAgIGNsb3VkcyxcbiAgICAgIHRva2VuOiBudWxsLFxuICAgIH0pO1xuXG4gICAgd2luZG93LlVSTFNlYXJjaFBhcmFtcyA9IGJlZm9yZTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xpc3QnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgbGlzdCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2xvdWRzID0geyB0ZXN0OiB0cnVlIH07XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikubGlzdCh7IC4uLmNsb3VkcyB9KTtcblxuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgZmxvdzogJ3dlYicsXG4gICAgICAgIGNsb3VkcyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgbGlzdCByZXF1ZXN0IHdpdGggc2Vzc2lvbiBjYWNoZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsb3VkcyA9IHsgdGVzdDogdHJ1ZSB9O1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oUElDS0VSX0tFWSwgdGVzdENsb3VkVG9rZW4pO1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24sIHtcbiAgICAgICAgc2Vzc2lvbkNhY2hlOiB0cnVlLFxuICAgICAgfSkubGlzdCh7IC4uLmNsb3VkcyB9KTtcblxuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgZmxvdzogJ3dlYicsXG4gICAgICAgIHRva2VuOiB0ZXN0Q2xvdWRUb2tlbixcbiAgICAgICAgY2xvdWRzLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNldCB0b2tlbiBvbiBhcGkgdG9rZW4gcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbG91ZHMgPSB7IHRva2VuOiB0cnVlIH07XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLmxpc3QoeyAuLi5jbG91ZHMgfSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoeyB0b2tlbjogdGVzdENsb3VkVG9rZW4gfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhY2hlIHNlc3Npb24gdG9rZW4gdG8gbG9jYWwgc3RvcmFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsb3VkcyA9IHsgdG9rZW46IHRydWUgfTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uLCB7IHNlc3Npb25DYWNoZTogdHJ1ZSB9KS5saXN0KHsgLi4uY2xvdWRzIH0pO1xuXG4gICAgICBleHBlY3QobG9jYWxTdG9yYWdlLnNldEl0ZW0pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFBJQ0tFUl9LRVksIHRlc3RDbG91ZFRva2VuKTtcbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoeyB0b2tlbjogdGVzdENsb3VkVG9rZW4gfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCBsaXN0IHJlcXVlc3Qgd2l0aCBzZWN1cml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsb3VkcyA9IHsgdGVzdDogdHJ1ZSB9O1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQoe1xuICAgICAgICAuLi50ZXN0U2Vzc2lvbixcbiAgICAgICAgLi4udGVzdFNlY3VyaXR5LFxuICAgICAgfSkubGlzdCh7IC4uLmNsb3VkcyB9KTtcblxuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgZmxvdzogJ3dlYicsXG4gICAgICAgIGNsb3VkcyxcbiAgICAgICAgLi4udGVzdFNlY3VyaXR5LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdG9yZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCBiYXNpYyByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS5zdG9yZSgnZ29vZ2xlJywgJ3Rlc3QnLCB7IGZpbGVuYW1lOiAnMScgfSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBjbG91ZHM6IHtcbiAgICAgICAgICBnb29nbGU6IHtcbiAgICAgICAgICAgIHBhdGg6ICd0ZXN0JyxcbiAgICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICAgIGZpbGVuYW1lOiAnMScsXG4gICAgICAgICAgICAgIGxvY2F0aW9uOiAnczMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3Qgc3RvcmUgbG9jYXRpb24gcGFyYW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnN0b3JlKCdnb29nbGUnLCAndGVzdCcsIHsgZmlsZW5hbWU6ICcxJywgbG9jYXRpb246ICdnY3MnIH0pO1xuXG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgICBmbG93OiAnd2ViJyxcbiAgICAgICAgY2xvdWRzOiB7XG4gICAgICAgICAgZ29vZ2xlOiB7XG4gICAgICAgICAgICBwYXRoOiAndGVzdCcsXG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBmaWxlbmFtZTogJzEnLFxuICAgICAgICAgICAgICBsb2NhdGlvbjogJ2djcycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzcGVjdCBzdG9yZSB1cGxvYWQgdGFncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwbG9hZFRhZ3MgPSB7IHRlc3RUYWc6ICd0ZXN0VGFnJyB9O1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnN0b3JlKCdnb29nbGUnLCAndGVzdCcsIHt9LCBudWxsLCBudWxsLCB1cGxvYWRUYWdzKTtcblxuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCh7XG4gICAgICAgIGFwaWtleTogdGVzdEFwaUtleSxcbiAgICAgICAgZmxvdzogJ3dlYicsXG4gICAgICAgIHVwbG9hZF90YWdzOiB1cGxvYWRUYWdzLFxuICAgICAgICBjbG91ZHM6IHtcbiAgICAgICAgICBnb29nbGU6IHtcbiAgICAgICAgICAgIHBhdGg6ICd0ZXN0JyxcbiAgICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICAgIGxvY2F0aW9uOiAnczMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCBiYXNpYyB3aXRoIHNlY3VyaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHtcbiAgICAgICAgLi4udGVzdFNlc3Npb24sXG4gICAgICAgIC4uLnRlc3RTZWN1cml0eSxcbiAgICAgIH0pLnN0b3JlKCd0b2tlbicsICd0ZXN0JywgeyBmaWxlbmFtZTogJzEnIH0pO1xuXG4gICAgICBjb25zdCBleGNlcHRlZCA9IHtcbiAgICAgICAgLi4udGVzdFNlY3VyaXR5LFxuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBjbG91ZHM6IHtcbiAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgcGF0aDogJ3Rlc3QnLFxuICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgZmlsZW5hbWU6ICcxJyxcbiAgICAgICAgICAgICAgbG9jYXRpb246ICdzMycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QobW9ja1N0b3JlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleGNlcHRlZCk7XG4gICAgICBleHBlY3QocmVzKS50b0VxdWFsKHRlc3RDbG91ZFRva2VuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGN1c3RvbSBzb3VyY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21Tb3VyY2UgPSB7XG4gICAgICAgIGN1c3RvbVNvdXJjZVBhdGg6ICdjc19wYXRoJyxcbiAgICAgICAgY3VzdG9tU291cmNlQ29udGFpbmVyOiAnY3NfY29udGFpbmVyJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikuc3RvcmUoJ2N1c3RvbXNvdXJjZScsICd0ZXN0JywgeyBmaWxlbmFtZTogJzEnIH0sIGN1c3RvbVNvdXJjZSk7XG5cbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoe1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIGZsb3c6ICd3ZWInLFxuICAgICAgICBjbG91ZHM6IHtcbiAgICAgICAgICBjdXN0b21zb3VyY2U6IHtcbiAgICAgICAgICAgIC4uLmN1c3RvbVNvdXJjZSxcbiAgICAgICAgICAgIHBhdGg6ICd0ZXN0JyxcbiAgICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICAgIGZpbGVuYW1lOiAnMScsXG4gICAgICAgICAgICAgIGxvY2F0aW9uOiAnczMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsb2dvdXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgcmVxdWVzdCB0byBsb2dvdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBleHBlY3QoYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS5sb2dvdXQoKSkudG9FcXVhbCh7IGFwaWtleTogJ0FQSV9LRVknLCBmbG93OiAnd2ViJyB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gbG9nb3V0IHdpdGggcHJvdmlkZWQgY2xvdWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBleHBlY3QoYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS5sb2dvdXQoJ2dvb2dsZScpKS50b0VxdWFsKHsgYXBpa2V5OiAnQVBJX0tFWScsIGZsb3c6ICd3ZWInLCBjbG91ZHM6IHsgZ29vZ2xlOiB7fSB9IH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgcmVxdWVzdCB0byBsb2dvdXQgYW5kIHJldHVybiBjb3JyZWN0IHJlc3BvbnNlIHdoZW4gY2xvdWQgbmFtZSBpcyByZXR1cm5lZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGV4cGVjdChhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLmxvZ291dCgndG9rZW4nKSkudG9FcXVhbCgndGVzdENsb3VkVG9rZW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gbG9nb3V0IGFuZCBjbGVhbiBzZXNzaW9uIGNhY2hlICcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFBJQ0tFUl9LRVksIHRlc3RDbG91ZFRva2VuKTtcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uLCB7IHNlc3Npb25DYWNoZTogdHJ1ZSB9KS5sb2dvdXQoKTtcblxuICAgICAgZXhwZWN0KGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChQSUNLRVJfS0VZKTtcbiAgICAgIGV4cGVjdChyZXMpLnRvRXF1YWwoeyBhcGlrZXk6ICdBUElfS0VZJywgZmxvdzogJ3dlYicsIHRva2VuOiB0ZXN0Q2xvdWRUb2tlbiB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21ldGFkYXRhJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXJsID0gJ2h0dHA6Ly90ZXN0LmNvbSc7XG5cbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikubWV0YWRhdGEodGVzdFVybCk7XG5cbiAgICAgIGV4cGVjdChtb2NrTWV0YWRhdGEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoU3RyaW5nKSwge1xuICAgICAgICBhcGlrZXk6IHRlc3RBcGlLZXksXG4gICAgICAgIHVybDogdGVzdFVybCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnbWV0YWRhdGEnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3Qgd2l0aCBzZWN1cml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RVcmwgPSAnaHR0cDovL3Rlc3QuY29tJztcblxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHtcbiAgICAgICAgLi4udGVzdFNlc3Npb24sXG4gICAgICAgIC4uLnRlc3RTZWN1cml0eSxcbiAgICAgIH0pLm1ldGFkYXRhKHRlc3RVcmwpO1xuXG4gICAgICBleHBlY3QobW9ja01ldGFkYXRhKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFN0cmluZyksIHtcbiAgICAgICAgYXBpa2V5OiB0ZXN0QXBpS2V5LFxuICAgICAgICB1cmw6IHRlc3RVcmwsXG4gICAgICAgIC4uLnRlc3RTZWN1cml0eSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnbWV0YWRhdGEnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ09wZW5Ub2snLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ3Rva0luaXQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHRvIGFwaSAoYXVkaW8pJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnRva0luaXQoJ2F1ZGlvJyk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tUb2tJbml0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFN0cmluZyksICcnKTtcbiAgICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnaW5pdCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gYXBpICh2aWRlbyknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikudG9rSW5pdCgnYXVkaW8nKTtcblxuICAgICAgICBleHBlY3QobW9ja1Rva0luaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoU3RyaW5nKSwgJycpO1xuICAgICAgICBleHBlY3QocmVzKS50b0VxdWFsKCdpbml0Jyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBvbiB3cm9uZyB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgIG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbilcbiAgICAgICAgICAgIC50b2tJbml0KCd2aWRlb2EnKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaW5pdCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnInKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KS50b1Rocm93RXJyb3IoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3Rva1N0YXJ0JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3QgcmVxdWVzdCB0byBhcGkgKGF1ZGlvKScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgbmV3IENsb3VkQ2xpZW50KHRlc3RTZXNzaW9uKS50b2tTdGFydCgnYXVkaW8nLCAna2V5JywgdGVzdFRva1Nlc3Npb24pO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVG9rU3RhcnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoU3RyaW5nKSwgeyBhcGlrZXk6ICdrZXknLCBzZXNzaW9uX2lkOiB0ZXN0VG9rU2Vzc2lvbiB9KTtcbiAgICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnc3RhcnQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIG1ha2UgY29ycmVjdCByZXF1ZXN0IHRvIGFwaSAodmlkZW8pJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgQ2xvdWRDbGllbnQodGVzdFNlc3Npb24pLnRva1N0YXJ0KCd2aWRlbycsICdrZXknLCB0ZXN0VG9rU2Vzc2lvbik7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tUb2tTdGFydCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueShTdHJpbmcpLCB7IGFwaWtleTogJ2tleScsIHNlc3Npb25faWQ6IHRlc3RUb2tTZXNzaW9uIH0pO1xuICAgICAgICBleHBlY3QocmVzKS50b0VxdWFsKCdzdGFydCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgb24gd3JvbmcgdHlwZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCgpID0+IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikudG9rU3RhcnQoJ3ZpZGVvYScsICdrZXknLCB0ZXN0VG9rU2Vzc2lvbikpLnRvVGhyb3dFcnJvcigpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndG9rU3RvcCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gYXBpIChhdWRpbyknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikudG9rU3RvcCgnYXVkaW8nLCAna2V5JywgdGVzdFRva1Nlc3Npb24sIHRlc3RUb2tBcmNoaXZlSWQpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVG9rU3RvcCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueShTdHJpbmcpLCB7XG4gICAgICAgICAgYXBpa2V5OiAna2V5JyxcbiAgICAgICAgICBzZXNzaW9uX2lkOiB0ZXN0VG9rU2Vzc2lvbixcbiAgICAgICAgICBhcmNoaXZlX2lkOiB0ZXN0VG9rQXJjaGl2ZUlkLFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnc3RvcCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgbWFrZSBjb3JyZWN0IHJlcXVlc3QgdG8gYXBpICh2aWRlbyknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikudG9rU3RvcCgndmlkZW8nLCAna2V5JywgdGVzdFRva1Nlc3Npb24sIHRlc3RUb2tBcmNoaXZlSWQpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVG9rU3RvcCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueShTdHJpbmcpLCB7XG4gICAgICAgICAgYXBpa2V5OiAna2V5JyxcbiAgICAgICAgICBzZXNzaW9uX2lkOiB0ZXN0VG9rU2Vzc2lvbixcbiAgICAgICAgICBhcmNoaXZlX2lkOiB0ZXN0VG9rQXJjaGl2ZUlkLFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KHJlcykudG9FcXVhbCgnc3RvcCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgb24gd3JvbmcgdHlwZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCgpID0+IG5ldyBDbG91ZENsaWVudCh0ZXN0U2Vzc2lvbikudG9rU3RvcCgndmlkZW9hJywgJ2tleScsIHRlc3RUb2tTZXNzaW9uLCB0ZXN0VG9rQXJjaGl2ZUlkKSkudG9UaHJvd0Vycm9yKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==
